from bottle import route, run, static_file, redirect, response
from library import Library
from os import getcwd
import webbrowser
import mimetypes

###########################################################################
# CONFIGURATION ###########################################################
###########################################################################
PORT = 9000
AUTO_LAUNCH_BROWSER = False
LIBRARY = Library()
###########################################################################

###########################################################################
# ROUTES ##################################################################
###########################################################################
@route('/')
def home():
    redirect("/index.html")

@route('/library')
def serve_library_json():
    response.content_type = "application/json; charset=UTF8"
    return LIBRARY.as_json()

@route('/<filepath:path>')
def serve_library_asset(filepath):
    return static_file(filepath, root=getcwd())
###########################################################################

###########################################################################
# UTILITY FUNCTIONS #######################################################
###########################################################################
def launch_browser():
    webbrowser.open_new("http://localhost:" + str(PORT))
###########################################################################

###########################################################################
# MAIN ####################################################################
###########################################################################
if __name__ == "__main__":
    LIBRARY.index()
    if AUTO_LAUNCH_BROWSER:
        launch_browser()
    run(host='0.0.0.0', port=PORT, debug=True)
###########################################################################